{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile - Nordic Trails</title>
  <link rel="icon" href="{% static 'images/logon4.png' %}">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=MedievalSharp&family=Poppins&display=swap" rel="stylesheet">
  <style>
    body {
      background: url('{% static 'images/tgg1b.jpg' %}') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Poppins', sans-serif;
      color: #e0cba8;
      padding: 2rem;
    }
    .nav {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-bottom: 1.5rem;
    }
    .nav a {
      text-decoration: none;
      font-family: 'Cinzel Decorative', serif;
      background: #e8d2a0d6;
      color: #0d1b2a;
      padding: 10px 20px;
      border-radius: 25px;
      transition: 0.3s ease;
      font-weight: bold;
      border: 1px solid #c9b37e;
    }
    .nav a:hover {
      background-color: rgba(1, 3, 52, 0.58);
      transform: scale(1.08);
    }
    .container {
      max-width: 600px;
      background-color: rgba(10, 20, 30, 0.9);
      padding: 2rem;
      border-radius: 14px;
      margin: auto;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }
    h1 {
      font-family: 'Cinzel Decorative', serif;
      color: #f4e9d8;
      text-align: center;
      margin-bottom: 1.5rem;
    }
    label {
      font-weight: bold;
      margin-bottom: 0.2rem;
      display: block;
    }
    input, select {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 0.3rem;
      border-radius: 8px;
      background-color: #102133;
      border: 1px solid #c9b37e;
      color: #fff;
    }
    input[type="submit"], .delete-btn {
      background-color: #c9b37e;
      border: none;
      font-weight: bold;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 1rem;
    }
    input[type="submit"]:hover, .delete-btn:hover {
      background-color: #e0cba8;
    }
    .danger-btn {
      background-color: #832f2f;
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1.5rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
      width: 100%;
    }
    .danger-btn:hover {
      background-color: #a63a3a;
      transform: scale(1.03);
    }
    .profile-pic {
      text-align: center;
      margin-bottom: 1.2rem;
    }
    .profile-pic img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 3px solid #c9b37e;
      object-fit: cover;
    }
    .file-label {
      display: inline-block;
      background-color: #38485e;
      color: #fff;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      margin: 1rem 0 0.5rem;
    }
    .file-label:hover {
      background-color: #4d5e74;
    }
    input[type="file"] {
      display: none;
    }
    .btn-row {
      display: flex;
      margin:8px 29px 5px -8px;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .error-message,
    .success-message {
      font-size: 0.85rem;
      margin-top: 0.3rem;
      padding-left: 0.4rem;
    }
    .error-message {
      color: #ff6b6b;
    }
    .success-message {
      color: #3bd26d;
    }
  </style>
</head>
<body>
<div class="nav">
  <a href="{% url 'dashboard' %}">← Dashboard</a>
  <a href="{% url 'logout' %}">Logout</a>
</div>

<div class="container">
  <h1>Your Profile</h1>
  <form method="POST" enctype="multipart/form-data" id="profileForm">
    {% csrf_token %}
    <div class="profile-pic">
      <img id="preview" src="{% if user_profile and user_profile.profile_pic %}{{ user_profile.profile_pic.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" alt="Profile Picture">
    </div>
    <div class="btn-row">
      <label class="file-label">
        Choose New Profile Picture
        <input type="file" name="profile_pic" id="profile_pic" accept="image/*" onchange="previewImage(event)">
      </label>
      {% if user_profile and user_profile.profile_pic %}
        <button type="submit" name="delete_pic" class="delete-btn" onclick="return confirm('Remove current profile picture?')">❌ Remove Profile Picture</button>
      {% endif %}
    </div>
    <label>Username</label>
    <input type="text" name="username" id="username" value="{{ user.username }}" required>
    <div class="error-message" id="userError"></div>
    <label>Email</label>
    <input type="email" name="email" id="email" value="{{ user.email }}" required>
    <div class="error-message" id="emailError"></div>
    <label>Phone Number</label>
    <input type="text" name="phone" id="phone" value="{{ user_profile.phone }}" required>
    <div class="error-message" id="phoneError"></div>
    <label>Account Type</label>
    <select name="account_type" required>
      <option {% if user_profile.account_type == 'Adventurer' %}selected{% endif %}>Adventurer</option>
      <option {% if user_profile.account_type == 'Historian' %}selected{% endif %}>Historian</option>
      <option {% if user_profile.account_type == 'Photographer' %}selected{% endif %}>Photographer</option>
      <option {% if user_profile.account_type == 'VIP Raider' %}selected{% endif %}>VIP Raider</option>
    </select>
    <label for="password">Password:</label>
    <input type="password" id="password" name="password">
    <div class="password-requirements">
      Password must contain:
      <ul style="margin-left: 1rem;">
        <li>At least one uppercase letter</li>
        <li>At least one lowercase letter</li>
        <li>At least one number</li>
        <li>At least one special character</li>
        <li>Minimum of 8 characters</li>
      </ul>
    </div>
    <div id="passError" class="error-message"></div>
    <label for="confirmPassword">Confirm Password:</label>
    <input type="password" id="confirmPassword" name="confirmPassword">
    <div id="confirmPassError" class="error-message"></div>
    <input type="submit" name="update_profile" value="Save Changes">
    <button type="submit" name="delete_account" class="danger-btn" onclick="return confirm('Are you sure you want to delete your account? This cannot be undone.')">
      ❌ Delete Account
    </button>
  </form>
</div>
<script>
  const usernameInput = document.getElementById("username");
  const phoneInput = document.getElementById("phone");
  const emailInput = document.getElementById("email");
  const userError = document.getElementById("userError");
  const phoneError = document.getElementById("phoneError");
  const emailError = document.getElementById("emailError");
  function previewImage(event) {
    const img = document.getElementById("preview");
    img.src = URL.createObjectURL(event.target.files[0]);
  }
  usernameInput.addEventListener("input", function () {
    const val = this.value.trim();
    userError.textContent = /^[a-zA-Z\s]+$/.test(val) ? "" : "Username must only contain letters.";
  });
  phoneInput.addEventListener("input", function () {
    const val = this.value.trim();
    phoneError.textContent = /^\+\d{8,15}$/.test(val) ? "" : "Phone must start with + and be 8–15 digits.";
  });
  document.getElementById("email").addEventListener("input", function () {
    const emailError = document.getElementById("emailError");
    const val = this.value.trim();
    const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    if (emailRegex.test(val)) {
      emailError.textContent = "✓ Valid email";
      emailError.className = "success-message";
    } else {
      emailError.textContent = "Enter a valid email address (e.g. name@example.com)";
      emailError.className = "error-message";
    }
  });
  const password = document.getElementById("password");
  const confirmPassword = document.getElementById("confirmPassword");
  const passError = document.getElementById("passError");
  const confirmPassError = document.getElementById("confirmPassError");
  password.addEventListener("input", () => {
    if (isStrongPassword(password.value)) {
      passError.textContent = "✓ Strong password";
      passError.className = "success-message";
    } else {
      passError.textContent = "Password must meet all listed requirements.";
      passError.className = "error-message";
    }
  });
  confirmPassword.addEventListener("input", function () {
    if (confirmPassword.value !== password.value) {
      confirmPassError.textContent = "Passwords do not match.";
    } else {
      confirmPassError.textContent = "";
    }
  });
  function isStrongPassword(pass) {
    return /[A-Z]/.test(pass) &&
           /[a-z]/.test(pass) &&
           /[0-9]/.test(pass) &&
           /[\W_]/.test(pass) &&
           pass.length >= 8;
  }
</script>
</body>
</html>
